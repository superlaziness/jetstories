(this.webpackJsonpjetstories=this.webpackJsonpjetstories||[]).push([[0],{113:function(e,t){},199:function(e,t,n){},325:function(e,t,n){},732:function(e,t,n){},733:function(e,t,n){},735:function(e,t,n){"use strict";n.r(t);var c=n(2),r=n(0),a=n.n(r),o=n(182),i=n.n(o),s=(n(199),n(13)),u=n(31),l=n(10),d=n(39),j=n(16),b=n(737),f=(n(325),function(e){var t=e.isFull,n=e.onButtonClick,r=Object(d.a)();return Object(c.jsx)(l.a,{children:Object(c.jsxs)("div",{className:Object(l.f)({alignItems:"end"}),children:[Object(c.jsx)("div",{className:Object(l.e)({default:"inline"}),children:Object(c.jsx)("a",{href:"https://www.jetbrains.com",target:"_blank",rel:"noopener noreferrer",children:Object(c.jsx)("div",{className:"jetbrains-logo _logo-jetbrains-square _size-3"})})}),t&&Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{className:Object(l.e)({default:"auto-fill"}),children:Object(c.jsx)("span",{className:r("wt-h2"),children:"JetStories"})}),Object(c.jsx)("div",{className:Object(l.e)({default:"inline"}),children:Object(c.jsx)(j.a,{onClick:n,mode:"contrast",children:"Add your story!"})})]}),!t&&Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{className:Object(l.e)({default:"auto-fill"}),children:" "}),Object(c.jsx)("div",{className:Object(l.e)({default:"inline"}),children:Object(c.jsx)(j.a,{onClick:n,icon:Object(c.jsx)(b.a,{}),mode:"contrast"})})]})]})})}),m=n(5),O=n.n(m),p=n(40),v=n(743),h=n(82),x=n.n(h),g=n(43),y=n.n(g),w=function(e,t){var n=Object(r.useState)([]),c=Object(s.a)(n,2),a=c[0],o=c[1];Object(r.useEffect)((function(){y.a.config.region="us-east-1",y.a.config.credentials=new y.a.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:19b76b20-93c7-4166-891b-88ebf401128e"})}),[]);return{upload:function(n){new y.a.S3.ManagedUpload({params:{Bucket:"test-sto",Key:"".concat((new Date).getTime(),".mp4"),Body:n,ACL:"public-read"}}).promise().then((function(t){e(t)}),(function(e){t(e)}))},getList:function(){new y.a.S3({apiVersion:"2006-03-01",params:{Bucket:"test-sto"}}).listObjects({Delimiter:"/"},(function(e,t){t&&t.Contents&&o(t.Contents),e&&console.log("failed getting list",e)}))},list:a}},N=n(26),k=n.n(N),C=n(38),R=n(192),S=n(738),T=function(e){var t=e.cameraRef,n=e.onRecordComplete,c=e.isRecording,a=e.onError,o=Object(r.useRef)(),i=Object(r.useRef)(null),s=function(e){n(e.data)},u=function(){var e=Object(C.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof MediaRecorder){e.next=3;break}return a("Browser not supported"),e.abrupt("return");case 3:return e.next=5,navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:4096},height:{ideal:2160}},audio:!0});case 5:o.current=e.sent,i.current=new MediaRecorder(o.current,{mimeType:"video/webm;codecs=H264,pcm"}),i.current.ondataavailable=s,(null===t||void 0===t?void 0:t.current)&&(t.current.srcObject=o.current);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){return u(),function(){var e;null===(e=o.current)||void 0===e||e.getTracks().forEach((function(e){e.stop()}))}}),[t]);Object(r.useEffect)((function(){c?function(){var e;null===(e=i.current)||void 0===e||e.start()}():function(){var e;null===(e=i.current)||void 0===e||e.stop()}()}),[c])},_=function(e){var t=e.time,n=void 0===t?10:t,a=e.isRunning,o=e.onOver;return Object(r.useEffect)((function(){var e;return a&&(e=setTimeout(o,1e3*n)),function(){e&&clearTimeout(e)}}),[a]),Object(c.jsx)("div",{className:O()("timer",a&&"timer__running"),children:Object(c.jsx)("div",{className:O()("bar",a&&"bar__running"),style:{transitionDuration:"".concat(n,"s")}})})},E=Object(c.jsx)("svg",{viewBox:"0 0 24 24",className:"wt-icon wt-icon_theme_light wt-icon_size_m",children:Object(c.jsx)("rect",{x:"6",y:"6",width:"12",height:"12",fill:"white"})}),P=function(e){var t=e.onRecordComplete,n=e.isRecording,a=e.onClickRecordStart,o=e.onClickRecordStop,i=e.onError,s=Object(r.useRef)();return T({cameraRef:s,isRecording:n,onRecordComplete:t,onError:i}),Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("video",{ref:s,autoPlay:!0,muted:!0}),Object(c.jsx)(_,{time:10,isRunning:n,onOver:o}),!n&&Object(c.jsx)(j.a,{mode:"contrast",onClick:a,icon:Object(c.jsx)(S.a,{className:"record-icon"}),children:"Record"}),n&&Object(c.jsx)(j.a,{className:"button__record",onClick:o,icon:E,children:"Record"})]})},F=n(741),L=n(742),B=n(58),D=n(84),M=n(739),U=n(740),I=(n(732),function(e){var t=e.onChange;return Object(c.jsxs)(D.b,{domain:[0,100],values:[0,100],mode:2,className:"wrapper",onUpdate:t,children:[Object(c.jsx)("div",{className:"track"}),Object(c.jsx)(D.a,{children:function(e){var t=e.handles,n=e.getHandleProps;return Object(c.jsx)("div",{children:t.map((function(e,t){return Object(c.jsx)("div",Object(B.a)(Object(B.a)({className:"handle",style:{left:"".concat(e.percent,"%"),marginLeft:0===t?"-30px":0}},n(e.id)),{},{children:0===t?Object(c.jsx)(M.a,{className:"handle-icon handle-icon__left"}):Object(c.jsx)(U.a,{className:"handle-icon handle-icon__right"})}),e.id)}))})}}),Object(c.jsx)(D.c,{left:!1,right:!1,children:function(e){var t=e.tracks,n=e.getTrackProps;return Object(c.jsx)("div",{children:t.map((function(e){var t=e.id,c=e.source,a=e.target;return Object(r.createElement)("div",Object(B.a)(Object(B.a)({style:{left:"".concat(c.percent,"%"),width:"".concat(a.percent-c.percent,"%")}},n(t)),{},{key:t,className:"track"}))}))})}})]})}),A=function(e){var t=e.playerRef,n=e.onEdit,c=e.blob,a=Object(r.useRef)([]),o=Object(r.useState)(0),i=Object(s.a)(o,2),u=i[0],l=i[1],d=Object(r.useState)(0),j=Object(s.a)(d,2),b=j[0],f=j[1],m=Object(r.useState)(0),O=Object(s.a)(m,2),p=O[0],v=O[1],h=function(e){var t=e.target.duration*a.current[1]/100||e.target.duration,n=a.current[0]*e.target.duration/100||0;e.target.currentTime>=t&&(e.target.currentTime=n,e.target.play())},x=function(){var e=Object(C.a)(k.a.mark((function e(){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=URL.createObjectURL(c),t.current.style.opacity=0,t.current.src=n;case 3:if(t.current.duration!==1/0&&!isNaN(t.current.duration)){e.next=9;break}return e.next=6,new Promise((function(e){return setTimeout(e,200)}));case 6:t.current.currentTime=1e7*Math.random(),e.next=3;break;case 9:v(t.current.duration),t.current.currentTime=0,t.current.style.opacity=1,t.current.play();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){return c&&t.current&&(x(),t.current.addEventListener("timeupdate",h)),function(){var e;null===(e=t.current)||void 0===e||e.removeEventListener("timeupdate",h)}}),[c]);return Object(r.useEffect)((function(){n({startTime:u,endTime:b,duration:p})}),[u,b,p]),{trim:function(e){var n=e[0]!==a.current[0]&&e[1]===a.current[1],c=e[1]!==a.current[1]&&e[0]===a.current[0];a.current=e,n&&t.current.duration!==1/0&&(t.current.currentTime=a.current[0]*t.current.duration/100,t.current.play(),l(t.current.currentTime)),c&&function(){if(t.current.duration!==1/0){var e=a.current[1]*t.current.duration/100;t.current.currentTime=e-.2,t.current.play(),f(e)}}()}}},J=function(e){var t=e.onEdit,n=e.videoData,a=e.onClickCancel,o=e.onClickUpload,i=Object(r.useRef)(),s=A({onEdit:t,blob:n,playerRef:i}).trim;return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("video",{ref:i}),Object(c.jsx)(I,{onChange:s}),Object(c.jsx)(j.a,{mode:"contrast",icon:Object(c.jsx)(F.a,{}),onClick:o,children:"Upload"})," ",Object(c.jsx)(j.a,{mode:"outline",icon:Object(c.jsx)(L.a,{}),onClick:a,children:"Cancel"})]})},z=function(e){var t=e.className,n=e.onSuccess,a=Object(p.a)(),o=Object(d.a)(),i=Object(r.useState)("idle"),u=Object(s.a)(i,2),l=u[0],b=u[1],f=Object(r.useState)(null),m=Object(s.a)(f,2),h=m[0],g=m[1],y=Object(r.useState)({}),N=Object(s.a)(y,2),S=N[0],T=N[1],_=function(e){return console.log("error",e)},E=function(e,t){return function(){var n=Object(C.a)(k.a.mark((function n(c,r){var a,o,i;return k.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=(null===r||void 0===r?void 0:r.startTime)?"-ss ".concat(r.startTime.toFixed(3)," "):"",o=(null===r||void 0===r?void 0:r.endTime)?" -to ".concat((r.endTime+.15).toFixed(3)):"",(i=new R.a).on("onReady",(function(){i.inputFile=c,i.runCommand("".concat(a,"-strict -2 -copyts").concat(o," -c:v copy out.mp4"),67108864)})),i.on("onStdout",(function(t){e(t)})),i.on("onStart",(function(){e("worker started")})),i.on("onDone",(function(e){var n=new Blob([e[0].data],{type:"video/mp4"});t(n)}));case 7:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}((function(e){return console.log("processing",e)}),(function(e){g(e),b("uploading")})),F=w((function(){return b("success")}),_).upload;Object(r.useEffect)((function(){"idle"===l&&(g(null),T({})),"processing"===l&&E(h,S),"uploading"===l&&(F(h),console.log(F)),"success"===l&&setTimeout((function(){return n()}),700)}),[l]);var L=function(e){var t=e.target.files[0],n=new FileReader;n.onloadend=function(e){var n=e.target.result,c=new Blob([new Uint8Array(n)],{type:t.type});g(c),b("recorded")},n.readAsArrayBuffer(t)};return console.log("state",l,S,h),Object(c.jsx)("div",{className:O()(t,"recorder-container"),children:Object(c.jsxs)("div",{className:O()(a("player",{sm:"player__sm"}),{"success-animation":"success"===l}),children:[("idle"===l||"recording"===l)&&Object(c.jsx)(P,{onRecordComplete:g,isRecording:"recording"===l,setState:b,onClickRecordStart:function(){return b("recording")},onClickRecordStop:function(){return b("recorded")},onError:function(){return b("notSupported")}}),"recorded"===l&&Object(c.jsx)(J,{videoData:h,onEdit:T,onClickCancel:function(){return b("idle")},onClickUpload:function(){return b("processing")}}),("processing"===l||"uploading"===l)&&Object(c.jsxs)("div",{className:"loading-state-report",children:[Object(c.jsx)(x.a,{radius:200,stroke:1,visible:!0}),Object(c.jsxs)("p",{className:O()("loading-state-message",o("wt-text-3")),children:[l,"..."]})]}),"notSupported"===l&&Object(c.jsxs)("div",{className:"not-supported",children:[Object(c.jsx)("h2",{className:o("wt-h1"),children:"\ud83d\ude14"}),Object(c.jsx)("p",{className:o("wt-text-1"),children:"Your browser does not support camera recording, please choose file from library"}),Object(c.jsx)(j.a,{mode:"contrast",icon:Object(c.jsx)(v.a,{}),onClick:function(){var e=document.createElement("input");e.onchange=L,e.type="file",e.accept="video/mp4, video/mov",e.click()},children:"Choose file"})]})]})})},H=function(e){var t=e.onSuccess,n=Object(d.a)(),r=Object(p.a)();return Object(c.jsx)(l.a,{children:Object(c.jsxs)("div",{className:"content",children:[Object(c.jsx)("h1",{className:O()("column",n("wt-hero"),"header"),children:"JetStories"}),Object(c.jsx)(z,{className:O()("column",r("recorder__lg",{md:"recorder"})),onSuccess:t}),Object(c.jsxs)("p",{className:O()("column","text",n("wt-subtitle-2",{flow:!0})),children:["Hi!",Object(c.jsx)("br",{}),"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor."]})]})})},K=n(744),q=(n(733),function(e){var t=e.onPlay,n=e.onStop,a=e.isPlaying,o=e.filePath,i=Object(r.useRef)();Object(r.useEffect)((function(){a||i.current.paused||i.current.pause()}),[a]);var u=Object(r.useState)(!1),l=Object(s.a)(u,2),d=l[0],b=l[1];return Object(r.useEffect)((function(){i.current&&(i.current.load(),i.current.oncanplaythrough=function(){b(!0),i.current.paused&&(i.current.currentTime=2)},i.current.onended=n)}),[i.current]),Object(c.jsxs)("div",{className:O()("story",{story__ready:d,story__playing:a}),children:[!d&&Object(c.jsx)(x.a,{className:"story-loader-spinner",radius:100,stroke:1,visible:!0}),Object(c.jsxs)("div",{className:"story-wrapper",onClick:function(){i.current.paused?(i.current.currentTime=0,i.current.play(),t()):(i.current.pause(),n())},children:[Object(c.jsx)("video",{src:"".concat("https://test-sto.s3.amazonaws.com/").concat(o),ref:i,preload:"metadata",playsInline:!0}),Object(c.jsx)(j.a,{className:"story-play-button",mode:"contrast",icon:Object(c.jsx)(K.a,{})})]})]})}),V=function(){var e=Object(r.useRef)(),t=Object(p.a)(),n=w(),a=n.getList,o=n.list;Object(r.useEffect)((function(){a()}),[]);var i=function(){var e=Object(r.useState)(),t=Object(s.a)(e,2),n=t[0],c=t[1];return{play:function(e){return c(e)},stop:function(){return c(void 0)},activePlayer:n}}(),u=i.play,d=i.stop,j=i.activePlayer;return console.log(o.sort((function(e,t){return console.log(new Date(e.LastModified)),new Date(t.LastModified)-new Date(e.LastModified)}))),console.log("list",o),Object(c.jsxs)("div",{className:Object(l.f)(),ref:e,children:[o.map((function(e,t){return Object(c.jsx)("div",{className:O()(Object(l.e)({default:3,lg:4,sm:12})),children:Object(c.jsx)(q,{filePath:e.Key,onPlay:function(){return u(t)},onStop:function(){return d(t)},isPlaying:j===t})},e.Key)})),0===o.length&&new Array(t(8,{lg:6,sm:3})).fill(void 0).map((function(e,t){return Object(c.jsx)("div",{className:O()(Object(l.e)({default:3,lg:4,sm:12})),children:Object(c.jsx)("div",{className:"story",children:Object(c.jsx)("div",{className:"story-wrapper"})})},t)}))]})},Y=function(){return Object(c.jsx)(l.a,{className:"wt-offset-top-48",children:Object(c.jsx)(V,{})})};n(734);var G=function(){var e=Object(r.useState)("player"),t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(c.jsx)(u.a,{theme:"dark",children:Object(c.jsxs)(l.b,{className:"layout",children:[Object(c.jsx)(l.d,{children:Object(c.jsx)(f,{isFull:"player"===n,onButtonClick:function(){return a("player"===n?"recorder":"player")}})}),Object(c.jsxs)(l.c,{children:["recorder"===n&&Object(c.jsx)(H,{onSuccess:function(){return a("player")}}),"player"===n&&Object(c.jsx)(Y,{})]})]})})},Q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,745)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),c(e),r(e),a(e),o(e)}))};i.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(G,{})}),document.getElementById("root")),Q()}},[[735,1,2]]]);
//# sourceMappingURL=main.5ecde44f.chunk.js.map