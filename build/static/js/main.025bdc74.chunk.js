(this.webpackJsonpjetstories=this.webpackJsonpjetstories||[]).push([[0],{112:function(e,t){},195:function(e,t,n){},321:function(e,t,n){},729:function(e,t,n){},730:function(e,t,n){},732:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n(0),a=n.n(c),o=n(179),i=n.n(o),s=(n(195),n(13)),u=n(31),l=n(10),d=n(39),j=n(16),b=n(734),f=(n(321),function(e){var t=e.isFull,n=e.onButtonClick,c=Object(d.a)();return Object(r.jsx)(l.a,{children:Object(r.jsxs)("div",{className:Object(l.f)({alignItems:"end"}),children:[Object(r.jsx)("div",{className:Object(l.e)({default:"inline"}),children:Object(r.jsx)("a",{href:"https://www.jetbrains.com",target:"_blank",rel:"noopener noreferrer",children:Object(r.jsx)("div",{className:"jetbrains-logo _logo-jetbrains-square _size-3"})})}),t&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("div",{className:Object(l.e)({default:"auto-fill"}),children:Object(r.jsx)("span",{className:c("wt-h2"),children:"JetStories"})}),Object(r.jsx)("div",{className:Object(l.e)({default:"inline"}),children:Object(r.jsx)(j.a,{onClick:n,mode:"contrast",children:"Add your story!"})})]}),!t&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("div",{className:Object(l.e)({default:"auto-fill"}),children:" "}),Object(r.jsx)("div",{className:Object(l.e)({default:"inline"}),children:Object(r.jsx)(j.a,{onClick:n,icon:Object(r.jsx)(b.a,{}),mode:"contrast"})})]})]})})}),m=n(5),O=n.n(m),p=n(40),v=n(740),h=n(82),x=n.n(h),g=n(43),y=n.n(g),k=function(e,t){var n=Object(c.useState)([]),r=Object(s.a)(n,2),a=r[0],o=r[1];Object(c.useEffect)((function(){y.a.config.region="us-east-1",y.a.config.credentials=new y.a.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:19b76b20-93c7-4166-891b-88ebf401128e"})}),[]);return{upload:function(n){new y.a.S3.ManagedUpload({params:{Bucket:"test-sto",Key:"".concat((new Date).getTime(),".mp4"),Body:n,ACL:"public-read"}}).promise().then((function(t){e(t)}),(function(e){t(e)}))},getList:function(){new y.a.S3({apiVersion:"2006-03-01",params:{Bucket:"test-sto"}}).listObjects({Delimiter:"/"},(function(e,t){t&&t.Contents&&o(t.Contents),e&&console.log("failed getting list",e)}))},list:a}},w=n(26),N=n.n(w),C=n(38),R=n(189),S=n(735),E=function(e){var t=e.cameraRef,n=e.onRecordComplete,r=e.isRecording,a=e.onError,o=Object(c.useRef)(),i=Object(c.useRef)(null),s=function(e){n(e.data)},u=function(){var e=Object(C.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof MediaRecorder){e.next=3;break}return a("Browser not supported"),e.abrupt("return");case 3:return e.next=5,navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:4096},height:{ideal:2160}},audio:!0});case 5:o.current=e.sent,i.current=new MediaRecorder(o.current,{mimeType:"video/x-matroska;codecs=avc1"}),i.current.ondataavailable=s,(null===t||void 0===t?void 0:t.current)&&(t.current.srcObject=o.current);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){return u(),function(){var e;null===(e=o.current)||void 0===e||e.getTracks().forEach((function(e){e.stop()}))}}),[t]);Object(c.useEffect)((function(){r?function(){var e;null===(e=i.current)||void 0===e||e.start()}():function(){var e;null===(e=i.current)||void 0===e||e.stop()}()}),[r])},T=function(e){var t=e.time,n=void 0===t?10:t,a=e.isRunning,o=e.onOver;return Object(c.useEffect)((function(){var e;return a&&(e=setTimeout(o,1e3*n)),function(){e&&clearTimeout(e)}}),[a]),Object(r.jsx)("div",{className:O()("timer",a&&"timer__running"),children:Object(r.jsx)("div",{className:O()("bar",a&&"bar__running"),style:{transitionDuration:"".concat(n,"s")}})})},_=Object(r.jsx)("svg",{viewBox:"0 0 24 24",className:"wt-icon wt-icon_theme_light wt-icon_size_m",children:Object(r.jsx)("rect",{x:"6",y:"6",width:"12",height:"12",fill:"white"})}),F=function(e){var t=e.onRecordComplete,n=e.isRecording,a=e.onClickRecordStart,o=e.onClickRecordStop,i=e.onError,s=Object(c.useRef)();return E({cameraRef:s,isRecording:n,onRecordComplete:t,onError:i}),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("video",{ref:s,autoPlay:!0,muted:!0}),Object(r.jsx)(T,{time:10,isRunning:n,onOver:o}),!n&&Object(r.jsx)(j.a,{mode:"contrast",onClick:a,icon:Object(r.jsx)(S.a,{className:"record-icon"}),children:"Record"}),n&&Object(r.jsx)(j.a,{className:"button__record",onClick:o,icon:_,children:"Record"})]})},M=n(738),P=n(739),L=n(58),B=n(83),D=n(736),U=n(737),A=(n(729),function(e){var t=e.onChange;return Object(r.jsxs)(B.b,{domain:[0,100],values:[0,100],mode:2,className:"wrapper",onUpdate:t,children:[Object(r.jsx)("div",{className:"track"}),Object(r.jsx)(B.a,{children:function(e){var t=e.handles,n=e.getHandleProps;return Object(r.jsx)("div",{children:t.map((function(e,t){return Object(r.jsx)("div",Object(L.a)(Object(L.a)({className:"handle",style:{left:"".concat(e.percent,"%"),marginLeft:0===t?"-30px":0}},n(e.id)),{},{children:0===t?Object(r.jsx)(D.a,{className:"handle-icon handle-icon__left"}):Object(r.jsx)(U.a,{className:"handle-icon handle-icon__right"})}),e.id)}))})}}),Object(r.jsx)(B.c,{left:!1,right:!1,children:function(e){var t=e.tracks,n=e.getTrackProps;return Object(r.jsx)("div",{children:t.map((function(e){var t=e.id,r=e.source,a=e.target;return Object(c.createElement)("div",Object(L.a)(Object(L.a)({style:{left:"".concat(r.percent,"%"),width:"".concat(a.percent-r.percent,"%")}},n(t)),{},{key:t,className:"track"}))}))})}})]})}),I=function(e){var t=e.playerRef,n=e.onEdit,r=e.blob,a=Object(c.useRef)([]),o=Object(c.useState)(0),i=Object(s.a)(o,2),u=i[0],l=i[1],d=Object(c.useState)(0),j=Object(s.a)(d,2),b=j[0],f=j[1],m=Object(c.useState)(0),O=Object(s.a)(m,2),p=O[0],v=O[1],h=function(e){var t=e.target.duration*a.current[1]/100||e.target.duration,n=a.current[0]*e.target.duration/100||0;e.target.currentTime>=t&&(e.target.currentTime=n,e.target.play())},x=function(){var e=Object(C.a)(N.a.mark((function e(){var n;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=URL.createObjectURL(r),t.current.style.opacity=0,t.current.src=n;case 3:if(t.current.duration!==1/0&&!isNaN(t.current.duration)){e.next=10;break}return e.next=6,new Promise((function(e){return setTimeout(e,200)}));case 6:console.log(t.current.duration),t.current.currentTime=1e7*Math.random(),e.next=3;break;case 10:v(t.current.duration),t.current.currentTime=0,t.current.style.opacity=1,t.current.play();case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){return r&&t.current&&(x(),t.current.addEventListener("timeupdate",h)),function(){var e;null===(e=t.current)||void 0===e||e.removeEventListener("timeupdate",h)}}),[r]);return Object(c.useEffect)((function(){n({startTime:u,endTime:b,duration:p})}),[u,b,p]),{trim:function(e){var n=e[0]!==a.current[0]&&e[1]===a.current[1],r=e[1]!==a.current[1]&&e[0]===a.current[0];a.current=e,n&&t.current.duration!==1/0&&(t.current.currentTime=a.current[0]*t.current.duration/100,t.current.play(),l(t.current.currentTime)),r&&function(){if(t.current.duration!==1/0){var e=a.current[1]*t.current.duration/100;t.current.currentTime=e-.2,t.current.play(),f(e)}}()}}},J=function(e){var t=e.onEdit,n=e.videoData,a=e.onClickCancel,o=e.onClickUpload,i=Object(c.useRef)(),s=I({onEdit:t,blob:n,playerRef:i}).trim;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("video",{ref:i}),Object(r.jsx)(A,{onChange:s}),Object(r.jsx)(j.a,{mode:"contrast",icon:Object(r.jsx)(M.a,{}),onClick:o,children:"Upload"})," ",Object(r.jsx)(j.a,{mode:"outline",icon:Object(r.jsx)(P.a,{}),onClick:a,children:"Cancel"})]})},z=function(e){var t=e.className,n=e.onSuccess,a=Object(p.a)(),o=Object(d.a)(),i=Object(c.useState)("idle"),u=Object(s.a)(i,2),l=u[0],b=u[1],f=Object(c.useState)(null),m=Object(s.a)(f,2),h=m[0],g=m[1],y=Object(c.useState)({}),w=Object(s.a)(y,2),S=w[0],E=w[1],T=function(e){return console.log("error",e)},_=function(e,t,n){return function(){var r=Object(C.a)(N.a.mark((function r(c,a){var o,i,s,u;return N.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=(null===a||void 0===a?void 0:a.startTime)?["-ss",a.startTime.toFixed(1)]:[],i=(null===a||void 0===a?void 0:a.endTime)?["-to",(a.endTime+.15).toFixed(1)]:[],r.next=4,c.arrayBuffer();case 4:s=r.sent,(u=new Worker(R.a)).onmessage=function(r){var c=r.data;switch(c.type){case"ready":u.postMessage({type:"run",MEMFS:[{name:"input.mkv",data:s}],arguments:["-i","input.mkv"].concat(o,i,["-copyts","-vcodec","copy","out.mp4"])});break;case"stdout":e(c.data);break;case"stderr":n(c.data);break;case"done":var a=new Blob([Uint8Array.from(c.data.MEMFS[0].data)],{type:"video/quicktime"});t(a);break;default:e("no source")}};case 7:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()}((function(e){return console.log("processing",e)}),(function(e){g(e),b("uploading")}),T),M=k((function(){return b("success")}),T).upload;console.log(_),Object(c.useEffect)((function(){"idle"===l&&(g(null),E({})),"processing"===l&&_(h,S),"uploading"===l&&M(h),"success"===l&&setTimeout((function(){return n()}),700)}),[l]);var P=function(e){var t=e.target.files[0],n=new FileReader;n.onloadend=function(e){var n=e.target.result,r=new Blob([new Uint8Array(n)],{type:t.type});g(r),b("recorded")},n.readAsArrayBuffer(t)};return console.log("state",l,S,h),Object(r.jsx)("div",{className:O()(t,"recorder-container"),children:Object(r.jsxs)("div",{className:O()(a("player",{sm:"player__sm"}),{"success-animation":"success"===l}),children:[("idle"===l||"recording"===l)&&Object(r.jsx)(F,{onRecordComplete:g,isRecording:"recording"===l,setState:b,onClickRecordStart:function(){return b("recording")},onClickRecordStop:function(){return b("recorded")},onError:function(){return b("notSupported")}}),"recorded"===l&&Object(r.jsx)(J,{videoData:h,onEdit:E,onClickCancel:function(){return b("idle")},onClickUpload:function(){return b("processing")}}),("processing"===l||"uploading"===l)&&Object(r.jsxs)("div",{className:"loading-state-report",children:[Object(r.jsx)(x.a,{radius:200,stroke:1,visible:!0}),Object(r.jsxs)("p",{className:O()("loading-state-message",o("wt-text-3")),children:[l,"..."]})]}),"notSupported"===l&&Object(r.jsxs)("div",{className:"not-supported",children:[Object(r.jsx)("h2",{className:o("wt-h1"),children:"\ud83d\ude14"}),Object(r.jsx)("p",{className:o("wt-text-1"),children:"Your browser does not support camera recording, please choose file from library"}),Object(r.jsx)(j.a,{mode:"contrast",icon:Object(r.jsx)(v.a,{}),onClick:function(){var e=document.createElement("input");e.onchange=P,e.type="file",e.accept="video/mp4, video/mov",e.click()},children:"Choose file"})]})]})})},K=function(e){var t=e.onSuccess,n=Object(d.a)(),c=Object(p.a)();return Object(r.jsx)(l.a,{children:Object(r.jsxs)("div",{className:"content",children:[Object(r.jsx)("h1",{className:O()("column",n("wt-hero"),"header"),children:"JetStories"}),Object(r.jsx)(z,{className:O()("column",c("recorder__lg",{md:"recorder"})),onSuccess:t}),Object(r.jsxs)("p",{className:O()("column","text",n("wt-subtitle-2",{flow:!0})),children:["Hi!",Object(r.jsx)("br",{}),"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor."]})]})})},q=n(741),H=(n(730),function(e){var t=e.onPlay,n=e.onStop,a=e.isPlaying,o=e.filePath,i=Object(c.useRef)();Object(c.useEffect)((function(){var e;a&&i.current.paused?(i.current.currentTime=0,i.current.play()):(i.current.currentTime=0,null===(e=i.current)||void 0===e||e.pause())}),[a]);var u=Object(c.useState)(!1),l=Object(s.a)(u,2),d=l[0],b=l[1];return Object(c.useEffect)((function(){i.current&&(i.current.load(),console.log("check",i.current.oncanplaythrough),i.current.oncanplaythrough=function(){b(!0)},i.current.onended=n)}),[i.current]),Object(r.jsxs)("div",{className:O()("story",{story__ready:d,story__playing:a}),children:[!d&&Object(r.jsx)(x.a,{className:"story-loader-spinner",radius:100,stroke:1,visible:!0}),Object(r.jsxs)("div",{className:"story-wrapper",onClick:function(){return a?n():t()},children:[Object(r.jsx)("video",{src:"".concat("https://test-sto.s3.amazonaws.com/").concat(o),ref:i,preload:"metadata"}),Object(r.jsx)(j.a,{className:"story-play-button",mode:"contrast",icon:Object(r.jsx)(q.a,{})})]})]})}),V=function(){var e=Object(c.useRef)(),t=Object(p.a)(),n=k(),a=n.getList,o=n.list;Object(c.useEffect)((function(){a()}),[]);var i=function(){var e=Object(c.useState)(),t=Object(s.a)(e,2),n=t[0],r=t[1];return{play:function(e){return r(e)},stop:function(){return r(void 0)},activePlayer:n}}(),u=i.play,d=i.stop,j=i.activePlayer;return console.log(o.sort((function(e,t){return console.log(new Date(e.LastModified)),new Date(t.LastModified)-new Date(e.LastModified)}))),console.log("list",o),Object(r.jsxs)("div",{className:Object(l.f)(),ref:e,children:[o.map((function(e,t){return Object(r.jsx)("div",{className:O()(Object(l.e)({default:3,lg:4,sm:12})),children:Object(r.jsx)(H,{filePath:e.Key,onPlay:function(){return u(t)},onStop:function(){return d(t)},isPlaying:j===t})},e.Key)})),0===o.length&&new Array(t(8,{lg:6,sm:3})).fill(void 0).map((function(e,t){return Object(r.jsx)("div",{className:O()(Object(l.e)({default:3,lg:4,sm:12})),children:Object(r.jsx)("div",{className:"story",children:Object(r.jsx)("div",{className:"story-wrapper"})})},t)}))]})},W=function(){return Object(r.jsx)(l.a,{className:"wt-offset-top-48",children:Object(r.jsx)(V,{})})};n(731);var Y=function(){var e=Object(c.useState)("player"),t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(r.jsx)(u.a,{theme:"dark",children:Object(r.jsxs)(l.b,{className:"layout",children:[Object(r.jsx)(l.d,{children:Object(r.jsx)(f,{isFull:"player"===n,onButtonClick:function(){return a("player"===n?"recorder":"player")}})}),Object(r.jsxs)(l.c,{children:["recorder"===n&&Object(r.jsx)(K,{onSuccess:function(){return a("player")}}),"player"===n&&Object(r.jsx)(W,{})]})]})})},G=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,742)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))};i.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(Y,{})}),document.getElementById("root")),G()}},[[732,1,2]]]);
//# sourceMappingURL=main.025bdc74.chunk.js.map