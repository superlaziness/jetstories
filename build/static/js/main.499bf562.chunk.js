(this.webpackJsonpjetstories=this.webpackJsonpjetstories||[]).push([[0],{110:function(e,t){},195:function(e,t,r){},321:function(e,t,r){},728:function(e,t,r){},730:function(e,t,r){},732:function(e,t,r){"use strict";r.r(t);var n=r(2),c=r(1),a=r.n(c),o=r(177),s=r.n(o),i=(r(195),r(13)),u=r(29),l=r(12),d=r(80),j=r(30),b=(r(321),function(e){var t=e.isFull,r=e.onButtonClick,c=Object(d.a)();return Object(n.jsx)(l.a,{children:Object(n.jsxs)("div",{className:Object(l.f)({alignItems:"end"}),children:[Object(n.jsx)("div",{className:Object(l.e)({default:"inline"}),children:Object(n.jsx)("a",{href:"https://www.jetbrains.com",target:"_blank",rel:"noopener noreferrer",children:Object(n.jsx)("div",{className:"jetbrains-logo _logo-jetbrains-square _size-3"})})}),t&&Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("div",{className:Object(l.e)({default:"auto-fill"}),children:Object(n.jsx)("span",{className:c("wt-h2"),children:"JetStories"})}),Object(n.jsx)("div",{className:Object(l.e)({default:"inline"}),children:Object(n.jsx)(j.a,{onClick:r,mode:"contrast",children:"Add your story!"})})]})]})})}),f=r(5),m=r.n(f),O=r(38),p=function(e){var t=e.time,r=void 0===t?10:t,a=e.isRunning,o=e.onOver;return Object(c.useEffect)((function(){var e;return a&&(e=setTimeout(o,1e3*r)),function(){e&&clearTimeout(e)}}),[a]),Object(n.jsx)("div",{className:m()("timer",a&&"timer__running"),children:Object(n.jsx)("div",{className:m()("bar",a&&"bar__running"),style:{transitionDuration:"".concat(r,"s")}})})},v=r(24),h=r.n(v),g=r(37),x=r(41),y=r.n(x),w=function(){var e=Object(c.useState)([]),t=Object(i.a)(e,2),r=t[0],n=t[1];Object(c.useEffect)((function(){y.a.config.region="us-east-1",y.a.config.credentials=new y.a.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:19b76b20-93c7-4166-891b-88ebf401128e"})}),[]);return{upload:function(e){var t=e.file,r=e.name;new y.a.S3.ManagedUpload({params:{Bucket:"test-sto",Key:r,Body:t,ACL:"public-read"}}).promise().then((function(e){console.log("uploaded",e)}),(function(e){console.log("error",e)}))},getList:function(){new y.a.S3({apiVersion:"2006-03-01",params:{Bucket:"test-sto"}}).listObjects({Delimiter:"/"},(function(e,t){t&&t.Contents&&n(t.Contents),e&&console.log("failed getting list",e)}))},list:r}},k=r(187),N=function(e){var t=e.resultRef,r=e.onUpdate,n=t.current,c=w().upload;return function(){var e=Object(g.a)(h.a.mark((function e(t,a){var o,s,i,u;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null===a||void 0===a?void 0:a.startTime)?["-ss",a.startTime.toFixed(1)]:[],s=(null===a||void 0===a?void 0:a.endTime)?["-to",(a.endTime+.15).toFixed(1)]:[],console.log("trimmer option",o,s),e.next=5,t.arrayBuffer();case 5:i=e.sent,(u=new Worker(k.a)).onmessage=function(e){var a=e.data;switch(a.type){case"ready":console.log("worker ready"),u.postMessage({type:"run",MEMFS:[{name:"input.mkv",data:i}],arguments:["-i","input.mkv"].concat(o,s,["-copyts","-vcodec","copy","out.mp4"])});break;case"stdout":console.log("worker stdout",a.data),r(a.data);break;case"stderr":console.log("worker stderr",a.data),r(a.data);break;case"done":console.log("worker done",a.data);var l=new Blob([Uint8Array.from(a.data.MEMFS[0].data)],{type:"video/quicktime"});c({name:"".concat((new Date).getTime(),".mp4"),file:l});var d=URL.createObjectURL(l);n.src=d,n.play(),console.log("blob",t);break;default:console.log("default")}};case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},R=function(e){var t=e.cameraRef,r=e.onRecordComplete,n=e.isRecording,a=Object(c.useRef)(),o=Object(c.useRef)(null),s=function(e){r(e.data)},i=function(){var e=Object(g.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:4096},height:{ideal:2160}},audio:!0});case 2:a.current=e.sent,o.current=new MediaRecorder(a.current,{mimeType:"video/x-matroska;codecs=avc1,opus"}),o.current.ondataavailable=s,(null===t||void 0===t?void 0:t.current)&&(t.current.srcObject=a.current);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){return i(),function(){var e;null===(e=a.current)||void 0===e||e.getTracks().forEach((function(e){e.stop()}))}}),[t]);Object(c.useEffect)((function(){n?function(){var e;null===(e=o.current)||void 0===e||e.start()}():function(){var e;null===(e=o.current)||void 0===e||e.stop()}()}),[n])},T=function(e){var t=e.onRecordComplete,r=e.isRecording,a=Object(c.useRef)();return R({cameraRef:a,isRecording:r,onRecordComplete:t}),Object(n.jsx)("video",{ref:a,autoPlay:!0,muted:!0})},C=r(55),S=r(81),E=r(734),_=r(735),P=(r(728),function(e){var t=e.onChange;return Object(n.jsxs)(S.b,{domain:[0,100],values:[0,100],mode:2,className:"wrapper",onUpdate:t,children:[Object(n.jsx)("div",{className:"track"}),Object(n.jsx)(S.a,{children:function(e){var t=e.handles,r=e.getHandleProps;return Object(n.jsx)("div",{children:t.map((function(e,t){return Object(n.jsx)("div",Object(C.a)(Object(C.a)({className:"handle",style:{left:"".concat(e.percent,"%"),marginLeft:0===t?"-30px":0}},r(e.id)),{},{children:0===t?Object(n.jsx)(E.a,{className:"handle-icon handle-icon__left"}):Object(n.jsx)(_.a,{className:"handle-icon handle-icon__right"})}),e.id)}))})}}),Object(n.jsx)(S.c,{left:!1,right:!1,children:function(e){var t=e.tracks,r=e.getTrackProps;return Object(n.jsx)("div",{children:t.map((function(e){var t=e.id,n=e.source,a=e.target;return Object(c.createElement)("div",Object(C.a)(Object(C.a)({style:{left:"".concat(n.percent,"%"),width:"".concat(a.percent-n.percent,"%")}},r(t)),{},{key:t,className:"track"}))}))})}})]})}),F=function(e){var t=e.playerRef,r=e.onEdit,n=e.blob,a=Object(c.useRef)([]),o=Object(c.useState)(0),s=Object(i.a)(o,2),u=s[0],l=s[1],d=Object(c.useState)(0),j=Object(i.a)(d,2),b=j[0],f=j[1],m=Object(c.useState)(0),O=Object(i.a)(m,2),p=O[0],v=O[1],x=function(e){var t=e.target.duration*a.current[1]/100||e.target.duration,r=a.current[0]*e.target.duration/100||0;e.target.currentTime>=t&&(e.target.currentTime=r,e.target.play())},y=function(){var e=Object(g.a)(h.a.mark((function e(){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=URL.createObjectURL(n),t.current.style.opacity=0,t.current.src=r;case 3:if(t.current.duration!==1/0&&!isNaN(t.current.duration)){e.next=10;break}return e.next=6,new Promise((function(e){return setTimeout(e,200)}));case 6:console.log(t.current.duration),t.current.currentTime=1e7*Math.random(),e.next=3;break;case 10:v(t.current.duration),t.current.currentTime=0,t.current.style.opacity=1,t.current.play();case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){return n&&t.current&&(y(),t.current.addEventListener("timeupdate",x)),function(){var e;null===(e=t.current)||void 0===e||e.removeEventListener("timeupdate",x)}}),[n]);return Object(c.useEffect)((function(){r({startTime:u,endTime:b,duration:p})}),[u,b,p]),{trim:function(e){var r=e[0]!==a.current[0]&&e[1]===a.current[1],n=e[1]!==a.current[1]&&e[0]===a.current[0];a.current=e,r&&t.current.duration!==1/0&&(t.current.currentTime=a.current[0]*t.current.duration/100,t.current.play(),l(t.current.currentTime)),n&&function(){if(t.current.duration!==1/0){var e=a.current[1]*t.current.duration/100;t.current.currentTime=e-.2,t.current.play(),f(e)}}()}}},L=function(e){var t=e.onEdit,r=e.videoData,a=Object(c.useRef)(),o=F({onEdit:t,blob:r,playerRef:a}).trim;return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("video",{ref:a,muted:!0}),Object(n.jsx)(P,{onChange:o})]})},M=function(e){var t=e.className,r=Object(O.a)(),a=Object(c.useState)("idle"),o=Object(i.a)(a,2),s=o[0],u=o[1],l=Object(c.useState)(null),d=Object(i.a)(l,2),b=d[0],f=d[1],v=Object(c.useState)({}),h=Object(i.a)(v,2),g=h[0],x=h[1],y=Object(c.useState)(""),w=Object(i.a)(y,2),k=w[0],R=w[1],C=Object(c.useRef)(null),S=N({resultRef:C,onUpdate:function(e){return R((function(t){return"".concat(t,"'\n'").concat(e)}))}});return console.log("state",s,g,b),Object(n.jsxs)("div",{className:m()(t,"recorder-container"),children:[Object(n.jsxs)("p",{style:{color:"white"},children:["Status: ",s]}),Object(n.jsxs)("p",{style:{color:"white"},children:["Message: ",k]}),Object(n.jsxs)("div",{className:r("player",{sm:"player__sm"}),children:["recorded"!==s&&Object(n.jsx)(T,{onRecordComplete:f,isRecording:"recording"===s}),"recorded"===s&&Object(n.jsx)(L,{videoData:b,onEdit:x}),"recorded"===s&&Object(n.jsx)("video",{ref:C,autoPlay:!0,muted:!0,loop:!0,controls:!0})]}),Object(n.jsx)(p,{time:10,isRunning:"recording"===s,onOver:function(){return u("recorded")}}),Object(n.jsx)(j.a,{mode:"contrast",onClick:function(){return u("recording"===s?"recorded":"recording")},children:"Record"}),Object(n.jsx)(j.a,{mode:"contrast",onClick:function(){return u("idle")},children:"Clear"}),Object(n.jsx)(j.a,{mode:"contrast",onClick:function(){return S(b,g)},children:"Process"}),Object(n.jsx)("input",{type:"file",id:"hello",onChange:function(e){var t=e.target.files[0],r=new FileReader;r.onloadend=function(e){var r=e.target.result,n=new Blob([new Uint8Array(r)],{type:t.type});f(n),u("recorded")},r.readAsArrayBuffer(t)}})]})},B=function(){var e=Object(d.a)(),t=Object(O.a)();return Object(n.jsx)(l.a,{children:Object(n.jsxs)("div",{className:"content",children:[Object(n.jsx)("h1",{className:m()("column",e("wt-hero"),"header"),children:"JetStories"}),Object(n.jsx)(M,{className:m()("column",t("recorder__lg",{md:"recorder"}))}),Object(n.jsxs)("p",{className:m()("column","text",e("wt-subtitle-2",{flow:!0})),children:["Hi!",Object(n.jsx)("br",{}),"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor."]})]})})},U=r(188),A=r.n(U),D=r(736),I=(r(730),function(e){var t=e.onPlay,r=e.onStop,a=e.isPlaying,o=e.filePath,s=Object(c.useRef)();Object(c.useEffect)((function(){var e;a&&s.current.paused?(s.current.currentTime=0,s.current.play()):(s.current.currentTime=0,null===(e=s.current)||void 0===e||e.pause())}),[a]);var u=Object(c.useState)(!1),l=Object(i.a)(u,2),d=l[0],b=l[1];return Object(c.useEffect)((function(){s.current&&(s.current.oncanplaythrough=function(){b(!0)},s.current.onended=r)}),[s.current]),Object(n.jsxs)("div",{className:m()("story",{story__ready:d,story__playing:a}),children:[!d&&Object(n.jsx)(A.a,{className:"story-loader-spinner",radius:100,stroke:1,visible:!0}),Object(n.jsxs)("div",{className:"story-wrapper",onClick:function(){return a?r():t()},children:[Object(n.jsx)("video",{src:"".concat("https://test-sto.s3.amazonaws.com/").concat(o),ref:s,preload:"metadata"}),Object(n.jsx)(j.a,{className:"story-play-button",mode:"contrast",icon:Object(n.jsx)(D.a,{})})]})]})}),J=function(){var e=Object(c.useRef)(),t=Object(O.a)(),r=w(),a=r.getList,o=r.list;Object(c.useEffect)((function(){a()}),[]);var s=function(){var e=Object(c.useState)(),t=Object(i.a)(e,2),r=t[0],n=t[1];return{play:function(e){return n(e)},stop:function(){return n(void 0)},activePlayer:r}}(),u=s.play,d=s.stop,j=s.activePlayer;return Object(n.jsxs)("div",{className:Object(l.f)(),ref:e,children:[o.map((function(e,t){return Object(n.jsx)("div",{className:m()(Object(l.e)({default:3,lg:4,sm:12})),children:Object(n.jsx)(I,{filePath:e.Key,onPlay:function(){return u(t)},onStop:function(){return d(t)},isPlaying:j===t})},e.key)})),0===o.length&&new Array(t(8,{lg:6,sm:3})).fill(void 0).map((function(e,t){return Object(n.jsx)("div",{className:m()(Object(l.e)({default:3,lg:4,sm:12})),children:Object(n.jsx)("div",{className:"story",children:Object(n.jsx)("div",{className:"story-wrapper"})})},t)}))]})},q=function(){return Object(n.jsx)(l.a,{className:"wt-offset-top-48",children:Object(n.jsx)(J,{})})};r(731);var z=function(){var e=Object(c.useState)("player"),t=Object(i.a)(e,2),r=t[0],a=t[1];return Object(n.jsx)(u.a,{theme:"dark",children:Object(n.jsxs)(l.b,{className:"layout",children:[Object(n.jsx)(l.d,{children:Object(n.jsx)(b,{isFull:"player"===r,onButtonClick:function(){return a("recorder")}})}),Object(n.jsxs)(l.c,{children:["recorder"===r&&Object(n.jsx)(B,{}),"player"===r&&Object(n.jsx)(q,{})]})]})})},H=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,737)).then((function(t){var r=t.getCLS,n=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;r(e),n(e),c(e),a(e),o(e)}))};s.a.render(Object(n.jsx)(a.a.StrictMode,{children:Object(n.jsx)(z,{})}),document.getElementById("root")),H()}},[[732,1,2]]]);
//# sourceMappingURL=main.499bf562.chunk.js.map